@model MonPDReborn.Models.DataOP.ProfilePotensiOPVM.ShowData

@{
    var currentYear = DateTime.Now.Year;
    var tahun1 = (currentYear - 2).ToString();
    var tahun2 = (currentYear - 1).ToString();
    var tahun3 = currentYear.ToString();
}

<div class="card-header d-flex">
    <div class="flex-grow-1">
        <h4 class="card-title fs-16 mb-0">
            Data Detail Kontrol Objek Pajak @Model.Kategori
        </h4>
    </div>
</div>
<div class="table-responsive">
    @(
Html.DevExtreme().DataGrid<MonPDReborn.Models.DataOP.ProfilePotensiOPVM.DataPotensi>()
    .ID("dataPotensiGrid")
    .DataSource(Model.DataPotensiList)
    .ShowBorders(true)
    .ShowColumnHeaders(true)
    .ShowColumnLines(true)
    .ShowRowLines(true)
    .AllowColumnResizing(true)
    .RowAlternationEnabled(true)
    .ColumnAutoWidth(true)
        .SearchPanel(s => s.Visible(true).HighlightCaseSensitive(false))
        .FilterRow(f => f.Visible(true))
        .HeaderFilter(h => h.Visible(true))
        .Sorting(s => s.Mode(GridSortingMode.Multiple))
    .Paging(p => p.PageSize(10))
    .Pager(p => p
        .ShowPageSizeSelector(true)
        .AllowedPageSizes(new[] { 10, 20, 50 })
        .ShowInfo(true)
    )
    .SearchPanel(sp => sp
        .Visible(true)
        .Width(240)
        .Placeholder("Cari...")
    )
    .Columns(columns =>
    {
        columns.AddFor(m => m.NOP).Caption("NOP");
        columns.AddFor(m => m.NamaWP).Caption("Nama WP");
        columns.AddFor(m => m.Alamat).Caption("Alamat");
        columns.AddFor(m => m.Kategori).Caption("Kategori Pajak");
        columns.AddFor(m => m.MasaPajak).Caption("Masa Pajak");
        columns.Add().Caption(tahun1).Alignment(HorizontalAlignment.Center).Columns(subColumns =>
            {
                subColumns.AddFor(m => m.Target1).Caption("Target").Format("#,##0");
                subColumns.AddFor(m => m.Realisasi1).Caption("Realisasi").Format("#,##0");
                subColumns.AddFor(m => m.Capaian1).Caption("Capaian").Format("#,#0%");
                });
        columns.Add().Caption(tahun2).Alignment(HorizontalAlignment.Center).Columns(subColumns =>
            {
                subColumns.AddFor(m => m.Target2).Caption("Target").Format("#,##0");
                subColumns.AddFor(m => m.Realisasi2).Caption("Realisasi").Format("#,##0");
                subColumns.AddFor(m => m.Capaian2).Caption("Capaian").Format("#,#0%");
                });
        columns.Add().Caption(tahun3).Alignment(HorizontalAlignment.Center).Columns(subColumns =>
            {
                subColumns.AddFor(m => m.Target3).Caption("Target").Format("#,##0");
                subColumns.AddFor(m => m.Realisasi3).Caption("Realisasi").Format("#,##0");
                subColumns.AddFor(m => m.Capaian3).Caption("Capaian").Format("#,#0%");
                });
        columns.AddFor(m => m.TotalPotensi).Caption("Total Potensi").Format("#,##0");
        columns.Add()
               .Type(GridCommandColumnType.Buttons)
               .Buttons(b =>
               {
                   b.Add()
                   .Text("Detail")
                   .Icon("search")
                   .OnClick("onDetail");
               });
    })
    .Summary(summary => {
        summary.TotalItems(items =>
        {
            items.AddFor(m => m.MasaPajak)
                 .SummaryType(SummaryType.Sum)
                 .DisplayFormat("Total");

            items.AddFor(m => m.Target1)
            .SummaryType(SummaryType.Sum)
            .CustomizeText(@<text>
                function(data) {
                    const formatted = new Intl.NumberFormat('id-ID', {
                        style: 'currency',
                        currency: 'IDR',
                        minimumFractionDigits: 0
                    }).format(data.value);
                    return formatted;
                }
            </text>);

            items.AddFor(m => m.Realisasi1)
            .SummaryType(SummaryType.Sum)
            .CustomizeText(@<text>
                function(data) {
                    const formatted = new Intl.NumberFormat('id-ID', {
                        style: 'currency',
                        currency: 'IDR',
                        minimumFractionDigits: 0
                    }).format(data.value);
                    return formatted;
                }
            </text>);

            items.AddFor(m => m.Target2)
            .SummaryType(SummaryType.Sum)
            .CustomizeText(@<text>
                function(data) {
                    const formatted = new Intl.NumberFormat('id-ID', {
                        style: 'currency',
                        currency: 'IDR',
                        minimumFractionDigits: 0
                    }).format(data.value);
                    return formatted;
                }
            </text>);

            items.AddFor(m => m.Realisasi2)
            .SummaryType(SummaryType.Sum)
            .CustomizeText(@<text>
                function(data) {
                    const formatted = new Intl.NumberFormat('id-ID', {
                        style: 'currency',
                        currency: 'IDR',
                        minimumFractionDigits: 0
                    }).format(data.value);
                    return formatted;
                }
            </text>);

            items.AddFor(m => m.Target3)
            .SummaryType(SummaryType.Sum)
            .CustomizeText(@<text>
                function(data) {
                    const formatted = new Intl.NumberFormat('id-ID', {
                        style: 'currency',
                        currency: 'IDR',
                        minimumFractionDigits: 0
                    }).format(data.value);
                    return formatted;
                }
            </text>);

            items.AddFor(m => m.Realisasi3)
            .SummaryType(SummaryType.Sum)
            .CustomizeText(@<text>
                function(data) {
                    const formatted = new Intl.NumberFormat('id-ID', {
                        style: 'currency',
                        currency: 'IDR',
                        minimumFractionDigits: 0
                    }).format(data.value);
                    return formatted;
                }
            </text>);
        });
    })
)
</div>
