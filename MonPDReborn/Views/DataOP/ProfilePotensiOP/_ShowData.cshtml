@model MonPDReborn.Models.DataOP.ProfilePotensiOPVM.ShowData



<div class="card-header d-flex">
    <div class="flex-grow-1">
        <h4 class="card-title fs-16 mb-0">
            Data Detail Kontrol Objek Pajak @Model.Kategori
        </h4>
    </div>
</div>


@{
    var currentYear = DateTime.Now.Year;
    var tahun1 = (currentYear - 2).ToString();
    var tahun2 = (currentYear - 1).ToString();
    var tahun3 = currentYear.ToString();
}
<div class="text-center mb-4">
    <div class="text-center">
        <div id="loading2-DataPotensi" class="spinner-border text-primary" style="display: none">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>

@(
Html.DevExtreme().DataGrid<MonPDReborn.Models.DataOP.ProfilePotensiOPVM.DataPotensi>()
    .ID("dataPotensiGrid")
    .DataSource(d => d.Mvc()
        .LoadAction("GetDataPotensi")
        .Key("NOP")
        .LoadParams(new
        {
            JenisPajak = Model.EnumPajak,
            kategori = Model.EnumKategori
        })
        .OnLoading("onDataGridContentLoad")
    )
    .OnContentReady("onDataGridContentReady")
    .ColumnAutoWidth(true)
    .ShowBorders(true)
    .ShowColumnHeaders(true)
    .ShowColumnLines(true)
    .ShowRowLines(true)
    .AllowColumnResizing(true)
    .RowAlternationEnabled(true)
        .Height("100%")
        .Width("100%")
        .SearchPanel(s => s.Visible(true).HighlightCaseSensitive(false))
        .FilterRow(f => f.Visible(true))
        .HeaderFilter(h => h.Visible(true))
        .Sorting(s => s.Mode(GridSortingMode.Multiple))
    .Paging(p => p.PageSize(10))
    .Pager(p => p
        .ShowPageSizeSelector(true)
        .AllowedPageSizes(new[] { 10, 20, 50 })
        .ShowInfo(true)
    )
    .SearchPanel(sp => sp
        .Visible(true)
        .Width(240)
        .Placeholder("Cari...")
    )
    .Columns(columns =>
    {
        columns.AddFor(m => m.FormattedNOP).Caption("NOP").Fixed(true);
        columns.AddFor(m => m.NamaOP).Caption("Nama WP").Fixed(true);
        columns.AddFor(m => m.Alamat).Caption("Alamat");
        columns.AddFor(m => m.Kategori).Caption("Kategori Pajak");
        columns.Add().Caption(tahun1).Alignment(HorizontalAlignment.Center).Columns(subColumns =>
            {
                subColumns.AddFor(m => m.Target1).Caption("Target").Format("#,##0");
                subColumns.AddFor(m => m.Realisasi1).Caption("Realisasi").Format("#,##0");
                subColumns.AddFor(m => m.Capaian1).Caption("Capaian").Format("#,#0%");
                subColumns.AddFor(m => m.Selisih1).Caption("Selisih").Format("#,##0");
            });
        columns.Add().Caption(tahun2).Alignment(HorizontalAlignment.Center).Columns(subColumns =>
            {
                subColumns.AddFor(m => m.Target2).Caption("Target").Format("#,##0");
                subColumns.AddFor(m => m.Realisasi2).Caption("Realisasi").Format("#,##0");
                subColumns.AddFor(m => m.Capaian2).Caption("Capaian").Format("#,#0%");
                subColumns.AddFor(m => m.Selisih2).Caption("Selisih").Format("#,##0");
            });
        columns.Add().Caption(tahun3).Alignment(HorizontalAlignment.Center).Columns(subColumns =>
            {
                subColumns.AddFor(m => m.Target3).Caption("Target").Format("#,##0");
                subColumns.AddFor(m => m.Realisasi3).Caption("Realisasi").Format("#,##0");
                subColumns.AddFor(m => m.Capaian3).Caption("Capaian").Format("#,#0%");
                subColumns.AddFor(m => m.Selisih3).Caption("Selisih").Format("#,##0");
            });
        columns.AddFor(m => m.TotalPotensi).Caption("Total Potensi").Format("#,##0");
        columns.Add()
               .Type(GridCommandColumnType.Buttons)
               .Fixed(false)
               .Buttons(b =>
               {
                   b.Add()
                   .Text("Detail")
                   .Icon("search")
                   .OnClick("onDetail");
               });
    })
    .Summary(summary =>
    {
        summary.TotalItems(items =>
        {
            items.AddFor(m => m.Kategori)
                 .SummaryType(SummaryType.Sum)
                 .DisplayFormat("Total");

            items.AddFor(m => m.Target1)
            .SummaryType(SummaryType.Sum)
            .ValueFormat("#,##0")
            .DisplayFormat("{0}");

            items.AddFor(m => m.Realisasi1)
            .SummaryType(SummaryType.Sum)
            .ValueFormat("#,##0")
            .DisplayFormat("{0}");

            items.AddFor(m => m.Capaian1)
                .SummaryType(SummaryType.Avg)  
                .ValueFormat("#,#0%").DisplayFormat("{0}");

            items.AddFor(m => m.Target2)
            .SummaryType(SummaryType.Sum)
            .ValueFormat("#,##0")
            .DisplayFormat("{0}");

            items.AddFor(m => m.Realisasi2)
            .SummaryType(SummaryType.Sum)
            .ValueFormat("#,##0")
            .DisplayFormat("{0}");

            items.AddFor(m => m.Capaian2)
                .SummaryType(SummaryType.Avg)  
                .ValueFormat("#,#0%").DisplayFormat("{0}");

            items.AddFor(m => m.Target3)
            .SummaryType(SummaryType.Sum)
            .ValueFormat("#,##0")
            .DisplayFormat("{0}");

            items.AddFor(m => m.Realisasi3)
            .SummaryType(SummaryType.Sum)
            .ValueFormat("#,##0")
            .DisplayFormat("{0}");

            items.AddFor(m => m.Capaian3)
                .SummaryType(SummaryType.Avg)  
                .ValueFormat("#,#0%").DisplayFormat("{0}");

            items.AddFor(m => m.TotalPotensi)
            .SummaryType(SummaryType.Sum)
            .ValueFormat("#,##0")
            .DisplayFormat("{0}");

        });
    })
)