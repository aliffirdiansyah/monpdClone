@model MonPDReborn.Models.Setting.CekDataVM.Show

<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex bg-header-color align-items-center">
                <div class="flex-grow-1">
                    <h4 class="card-title text-dark fs-16 mb-1">
                        Data Realisasi
                    </h4>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    @(Html.DevExtreme().DataGrid<MonPDReborn.Models.Setting.CekDataVM.DataRealisasi>()
                        .ID("dataRealisasiGrid")
                        .OnCellPrepared("onRealisasiCellPrepared")
                        .DataSource(Model.DataRealisasiList)
                        .KeyExpr("jenisPajak")
                        .ShowBorders(true)
                        .ShowColumnHeaders(true)
                        .ShowColumnLines(true)
                        .ShowRowLines(true)
                        .AllowColumnResizing(true)
                        .ColumnAutoWidth(true)
                        @* .SearchPanel(s => s.Visible(true).HighlightCaseSensitive(false))
                        .FilterRow(f => f.Visible(true))
                        .HeaderFilter(h => h.Visible(true))
                        .Sorting(s => s.Mode(GridSortingMode.Multiple))
                        .Paging(p => p.PageSize(25)) *@
                        .Export(e => e.Enabled(true).AllowExportSelectedData(false).Formats(new[] { "xlsx", "pdf" }))
                        .OnExporting("exportGrid")
                        .NoDataText("Objek Pajak Tidak Ditemukan")
                        .Columns(columns =>
                        {
                            columns.AddFor(m => m.jenisPajak)
                                .Caption("Jenis Pajak");

                            columns.AddFor(m => m.realisasi)
                                .Caption("Realisasi")
                                .Format("#,##0");
                        })
                        .Summary(s => {
                            s.TotalItems(items => {
                                items.AddFor(x => x.jenisPajak)
                                    .SummaryType(SummaryType.Sum)
                                    .DisplayFormat("Total");

                                items.AddFor(x => x.realisasi)
                                    .SummaryType(SummaryType.Sum)
                                    .ValueFormat("#,##0")
                                    .DisplayFormat("{0}");
                            });
                        })
                          // tambahkan handler
                    )
                </div>
            </div>
        </div>
        
        

    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex bg-header-color align-items-center">
                <div class="flex-grow-1">
                    <h4 class="card-title text-dark fs-16 mb-1">
                        Data Scontro
                    </h4>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    @(Html.DevExtreme().DataGrid<MonPDReborn.Models.Setting.CekDataVM.DataScontro>()
                .ID("dataScontroGrid")
                .OnContentReady("onScontroReady")
                .DataSource(Model.DataScontroList)
                .KeyExpr("jenisPajak")
                .ShowBorders(true)
                .ShowColumnHeaders(true)
                .ShowColumnLines(true)
                .ShowRowLines(true)
                .AllowColumnResizing(true)
                .ColumnAutoWidth(true)
                @* .SearchPanel(s => s.Visible(true).HighlightCaseSensitive(false))
                .FilterRow(f => f.Visible(true))
                .HeaderFilter(h => h.Visible(true))
                .Sorting(s => s.Mode(GridSortingMode.Multiple))
                .Paging(p => p.PageSize(25))
                .Pager(p => p
                .ShowPageSizeSelector(true)
                .AllowedPageSizes(new[] { 10, 20, 50 })
                .ShowInfo(true)
                ) *@
                .Export(e => e.Enabled(true).AllowExportSelectedData(false).Formats(new[] { "xlsx", "pdf" }))
                .OnExporting("exportGrid")
                .NoDataText("Objek Pajak Tidak Ditemukan")
                .Columns(columns =>
                {
                  // Kolom Nama WS
                    columns.AddFor(m => m.jenisPajak)
                    .Caption("Jenis Pajak");

                    // Kolom Last Run
                    columns.AddFor(m => m.scontro)
                    .Caption("Realisasi").Format("#,##0");

                })
                .Summary(s => {
                    s.TotalItems(items => {
                        items.AddFor(x => x.jenisPajak)
                            .SummaryType(SummaryType.Sum)
                            .DisplayFormat("Total");

                        items.AddFor(x => x.scontro)
                            .SummaryType(SummaryType.Sum)
                .ValueFormat("#,##0")
                            .DisplayFormat("{0}");
                    });
                })
                

                )
                </div>
            </div>
        </div>
        
    </div>
    <center>
        <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex bg-header-color align-items-center">
                <div class="flex-grow-1">
                    <h4 class="card-title text-dark fs-16 mb-1">
                        Selisih Data
                    </h4>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    @(Html.DevExtreme().DataGrid<MonPDReborn.Models.Setting.CekDataVM.DataSelisih>()
                .ID("dataSelisihGrid")
                .DataSource(Model.DataSelisihList)
                .KeyExpr("jenisPajak")
                .ShowBorders(true)
                .ShowColumnHeaders(true)
                .ShowColumnLines(true)
                .ShowRowLines(true)
                .AllowColumnResizing(true)
                .ColumnAutoWidth(true)
                .SearchPanel(s => s.Visible(true).HighlightCaseSensitive(false))
                .FilterRow(f => f.Visible(true))
                .HeaderFilter(h => h.Visible(true))
                .Sorting(s => s.Mode(GridSortingMode.Multiple))
                .Paging(p => p.PageSize(25))
                .Export(e => e.Enabled(true).AllowExportSelectedData(false).Formats(new[] { "xlsx", "pdf" }))
                .OnExporting("exportGrid")
                .NoDataText("Objek Pajak Tidak Ditemukan")
                .Columns(columns =>
                {
                  // Kolom Nama WS
                    columns.AddFor(m => m.jenisPajak)
                    .Caption("Jenis Pajak");

                    // Kolom Last Run
                    columns.AddFor(m => m.selisih)
                    .Caption("Realisasi").Format("#,##0");

                })
                .Summary(s => {
                    s.TotalItems(items => {
                        items.AddFor(x => x.jenisPajak)
                            .SummaryType(SummaryType.Sum)
                            .DisplayFormat("Total");

                        items.AddFor(x => x.selisih)
                            .SummaryType(SummaryType.Sum)
                .ValueFormat("#,##0")
                            .DisplayFormat("{0}");
                    });
                })

                )
                </div>
            </div>
        </div>
        
    </div>
    </center>
    
</div>

@* <script>
    function parseNumber(val) {
            if (val == null) return 0;
            return Number(String(val).replace(/\./g, "").replace(/,/g, ""));
        }

        // Dipanggil saat cell di grid kiri (dataRealisasiGrid) di-render
        function onRealisasiCellPrepared(e) {
            if (e.rowType === "data" && e.column.dataField === "realisasi") {
                // reset style dulu
                e.cellElement.css({
                    "background-color": "",
                    "color": "",
                    "font-weight": ""
                });

                let scontroGrid = $("#dataScontroGrid").dxDataGrid("instance");
                if (!scontroGrid) return;

                let scontroData = scontroGrid.getDataSource().items();

                let match = scontroData.find(x =>
                    String(x.jenisPajak).trim().toLowerCase() === String(e.data.jenisPajak).trim().toLowerCase()
                );

                let valRealisasi = parseNumber(e.data.realisasi);
                let valScontro = match ? parseNumber(match.scontro) : null;

                if (valScontro !== null) {
                    if (valRealisasi === valScontro) {
                        e.cellElement.css({
                            "background-color": "#ccffcc",
                            "color": "green",
                            "font-weight": "bold"
                        });
                    } else if (valRealisasi < valScontro) {
                        e.cellElement.css({
                            "background-color": "#ffcccc",
                            "color": "red",
                            "font-weight": "bold"
                        });
                    }
                }
            }
        }
</script> *@
