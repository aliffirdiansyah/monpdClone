@model MonPDReborn.Models.Reklame.KakulatorReklameVM.Index

@{
    ViewData["Title"] = "Kakulator Reklame";
    Layout = "~/Views/Shared/_LayoutReklame.cshtml";
}

<div class="row">

    <div class="col-lg-12">
        <div class="card">
            <div class="card-header d-flex bg-header-color align-items-center">
                <div class="flex-grow-1">
                    <h4 class="card-title text-dark fs-16 mb-1">
                        Kalkulator Reklame
                    </h4>
                </div>
            </div>
            <div class="card shadow-sm">

                <div class="card-body">
                    <div class="row g-3 align-items-end">
                        <!-- ✅ tambahkan align-items-end agar tombol sejajar -->
                        <!-- Panjang -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="Panjang" class="form-label fw-semibold">Panjang (m)</label>
                            @(Html.DevExtreme().NumberBox()
                                .ID("Panjang")
                                .ShowClearButton(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Panjang bidang reklame dalam meter, diukur dari sisi kiri ke kanan papan reklame.
                            </small>
                        </div>

                        <!-- Lebar -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="Lebar" class="form-label fw-semibold">Lebar (m)</label>
                            @(Html.DevExtreme().NumberBox()
                                .ID("Lebar")
                                .ShowClearButton(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Lebar bidang reklame dalam meter, diukur dari sisi bawah ke atas papan reklame.
                            </small>
                        </div>

                        <!-- Tinggi -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="Tinggi" class="form-label fw-semibold">Tinggi (m)</label>
                            @(Html.DevExtreme().NumberBox()
                                .ID("Tinggi")
                                .ShowClearButton(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Ketinggian posisi reklame dari permukaan tanah ke titik bawah reklame.
                            </small>
                        </div>

                        <!-- Sudut Pandang -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="SudutPandang" class="form-label fw-semibold">Sudut Pandang (°)</label>
                            @(Html.DevExtreme().NumberBox()
                                .ID("SudutPandang")
                                .ShowClearButton(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Besaran sudut kemiringan papan reklame terhadap arah pandang pengguna jalan.
                            </small>
                        </div>

                        <!-- Sisi -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="Sisi" class="form-label fw-semibold">Jumlah Sisi</label>
                            @(Html.DevExtreme().NumberBox()
                                .ID("Sisi")
                                .ShowClearButton(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Jumlah sisi reklame yang menampilkan iklan (misal: 1 sisi tunggal, 2 sisi bolak-balik).
                            </small>
                        </div>

                        <!-- Nama Jalan -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="NamaJalan" class="form-label fw-semibold">Nama Jalan</label>
                            @(Html.DevExtreme().SelectBox()
                                .ID("NamaJalan")
                                .DataSource(Model.JalanList)
                                .DisplayExpr("Text")
                                .ValueExpr("Value")
                                .Placeholder("Pilih Nama Jalan")
                                .SearchEnabled(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Lokasi jalan tempat reklame dipasang, berpengaruh pada nilai strategis (NSR).
                            </small>
                        </div>

                        <!-- Jenis Reklame -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="JenisReklame" class="form-label fw-semibold">Jenis Reklame</label>
                            @(Html.DevExtreme().SelectBox()
                                .ID("JenisReklame")
                                .DataSource(Model.JenisReklameList)
                                .DisplayExpr("Text")
                                .ValueExpr("Value")
                                .Placeholder("Pilih Jenis Reklame")
                                .SearchEnabled(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Jenis media reklame, misalnya papan/baliho, videotron, spanduk, atau neon box.
                            </small>
                        </div>

                        <!-- Letak Reklame -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="LetakReklame" class="form-label fw-semibold">Letak Reklame</label>
                            @(Html.DevExtreme().SelectBox()
                                .ID("LetakReklame")
                                .DataSource(Model.LetakReklameList)
                                .DisplayExpr("Text")
                                .ValueExpr("Value")
                                .Placeholder("Pilih Letak Reklame")
                                .SearchEnabled(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Posisi reklame terhadap bangunan atau jalan, misalnya: di atas gedung, menempel di tembok, atau berdiri sendiri.
                            </small>
                        </div>

                        <!-- Produk -->
                        <div class="col-12 col-md-6 col-lg-3">
                            <label for="produkList" class="form-label fw-semibold">Jenis Produk</label>
                            @(Html.DevExtreme().SelectBox()
                                .ID("produkList")
                                .DataSource(Model.ProdukList)
                                .DisplayExpr("Text")
                                .ValueExpr("Value")
                                .Placeholder("Pilih Produk")
                                .SearchEnabled(true)
                                .StylingMode(EditorStylingMode.Outlined)
                                .ElementAttr("class", ""))
                            <small class="text-danger d-block mt-1">
                                Kategori produk atau layanan yang diiklankan pada media reklame.
                            </small>
                        </div>

                        <!-- Tombol Hitung -->
                        <div class="col-12 col-md-6 col-lg-3 d-flex align-items-end">
                            <!-- ✅ agar sejajar dengan input -->
                            <button type="button" class="btn btn-success w-100" id="btnFilter">
                                <i class="bi bi-funnel-fill me-1"></i> Hitung NSR
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="col-lg-12">
        <div class="card">
            <div class="card-header d-flex bg-header-color align-items-center">
                <div class="flex-grow-1">
                    <h4 class="card-title text-dark fs-16 mb-1">
                        Hasil Perhitungan
                    </h4>
                </div>
            </div>
            <div class="card-body">
                <div id="loading2-Show" style="display:none;">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
                <div id="Show">
                </div>
            </div>
        </div>
    </div>

</div>

@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function loadShowData() {
            let jenisReklame = $("#JenisReklame").dxSelectBox("instance").option("value");
            let letakReklame = $("#LetakReklame").dxSelectBox("instance").option("value");
            let produk = $("#produkList").dxSelectBox("instance").option("value");
            let NamaJalan = $("#NamaJalan").dxSelectBox("instance")?.option("value");
            let panjang = $("#Panjang").dxNumberBox("instance")?.option("value");
            let lebar = $("#Lebar").dxNumberBox("instance")?.option("value");
            let sisi = $("#Sisi").dxNumberBox("instance")?.option("value");
            let tinggi = $("#Tinggi").dxNumberBox("instance")?.option("value");
            let sudutPandang = $("#SudutPandang").dxNumberBox("instance")?.option("value");

            if (!jenisReklame || !letakReklame || !produk || !NamaJalan || !panjang || !lebar || !tinggi ||!sudutPandang) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Verifikasi Data',
                    text: '⚠ Harap pilih semua filter utama sebelum menerapkan.',
                    confirmButtonText: 'OK'
                });
                return;
            }
            $.ajax({
                url: '@Url.Action("Show", "KakulatorReklame")',
                type: "GET",
                data: {
                    IdJenisReklame: jenisReklame,
                    IdLetakReklame: letakReklame,
                    IdJenisProduk: produk,
                    NamaJalan: NamaJalan,
                    Sisi: sisi,
                    panjang: panjang,
                    lebar: lebar,
                    tinggi: tinggi,
                    sudutPandang: sudutPandang
                },
                beforeSend: function () {
                    $("#Show").hide();
                    $("#loading2-Show").show();
                },
                success: function (response) {
                    $("#Show").html(response);
                },
                error: function (xhr, status, error) {
                    console.error("Error:", error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Terjadi Kesalahan',
                        text: 'Gagal memuat data show.'
                    });
                },
                complete: function () {
                    $("#loading2-Show").hide();
                    $("#Show").show();
                }
            });
        }

        $(".btn-success").on("click", loadShowData);
    </script>


}